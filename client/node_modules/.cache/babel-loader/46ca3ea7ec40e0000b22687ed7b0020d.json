{"ast":null,"code":"var _jsxFileName = \"/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx\",\n    _s = $RefreshSig$();\n\nimport { React, useState } from \"react\";\nimport { getChannels, getUsers, getUserChannel } from \"../../api/logic/getters\";\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatPage(_ref) {\n  _s();\n\n  let {\n    currentUser\n  } = _ref;\n  console.log(\"CURRENT USER ROOMS:\", currentUser.roomExistUsers);\n  const [channels, setChannels] = useState(currentUser.roomExistUsers); // const [users, setUsers] = useState(getUsers());\n\n  const [selectedChannel, setSelectedChannel] = useState({});\n  const [connection, setConnection] = useState();\n  console.log(\"Current user: \", currentUser);\n  useEffect(() => {\n    // declare the data fetching function\n    const connect = async () => {\n      try {\n        const connection = new HubConnectionBuilder().withUrl(`${URL}/chatHub`).configureLogging(LogLevel.Information).build();\n        console.log(\"SignalR Connected.\");\n        connection.on(\"AddChannel\", channel => console.log(channel));\n        connection.on(\"onError\", msg => console.log(msg));\n        connection.on(\"RecieveMessage\", message => {\n          console.log(\"RECIEVING MESSAGE: \", message, \"\\nCURRENT USER:\", currentUser);\n          const copyChannel = Object.assign({}, currentUser.roomExistUsers.filter(room => room.id === message.toRoomId)[0]);\n\n          if (copyChannel.messages !== null) {\n            copyChannel.messages.push(message);\n          } else {\n            copyChannel.messages = [message];\n          }\n\n          setChannels(channels => {\n            channels.map(channel => {\n              if (channel.id !== copyChannel.id) {\n                return channel;\n              } else {\n                return copyChannel;\n              }\n            });\n          });\n        });\n        connection.onclose(e => {\n          setConnection();\n        });\n        await connection.start();\n        setConnection(connection);\n      } catch (err) {\n        console.log(err);\n      }\n\n      ;\n    }; // call the function\n\n\n    connect() // make sure to catch any error\n    .catch(console.error);\n  }, []);\n\n  const createChannel = async (channel, user, members) => {\n    try {\n      await connection.invoke(\"CreateRoom\", channel, user, members);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const sendMessage = async (channel, user, message) => {\n    try {\n      await connection.invoke(\"SendToRoom\", channel, user, message);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const getAllUsers = async () => {\n    try {\n      const data = await connection.invoke(\"GetAllUsers\");\n      return data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatLobby, {\n      currentUser: currentUser,\n      channels: channels,\n      setChannels: setChannels // users={users}\n      // setUsers={setUsers}\n      ,\n      selectedChannel: selectedChannel,\n      setSelectedChannel: setSelectedChannel,\n      createChannel: createChannel,\n      sendMessage: sendMessage,\n      getAllUsers: getAllUsers\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ChatPage, \"CesSjSxVGwvNMa15PGjGlSE7pio=\");\n\n_c = ChatPage;\n;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useState","getChannels","getUsers","getUserChannel","Sidebar","ChatLobby","ChatPage","currentUser","console","log","roomExistUsers","channels","setChannels","selectedChannel","setSelectedChannel","connection","setConnection","useEffect","connect","HubConnectionBuilder","withUrl","URL","configureLogging","LogLevel","Information","build","on","channel","msg","message","copyChannel","Object","assign","filter","room","id","toRoomId","messages","push","map","onclose","e","start","err","catch","error","createChannel","user","members","invoke","sendMessage","getAllUsers","data"],"sources":["/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx"],"sourcesContent":["import {React, useState} from \"react\";\n\n\nimport { getChannels, getUsers, getUserChannel } from \"../../api/logic/getters\";\n\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\n\nexport default function ChatPage( \n    {currentUser} ){\n\n    console.log(\"CURRENT USER ROOMS:\", currentUser.roomExistUsers);\n    const [channels, setChannels] = useState(currentUser.roomExistUsers);\n    // const [users, setUsers] = useState(getUsers());\n    const [selectedChannel, setSelectedChannel] = useState({});   \n    \n    const [connection, setConnection] = useState();\n    \n    console.log(\"Current user: \", currentUser);\n\n    useEffect(() => {\n        // declare the data fetching function\n        const connect = async () => {\n            try {\n                const connection = new HubConnectionBuilder()\n                .withUrl(`${URL}/chatHub`)\n                .configureLogging(LogLevel.Information)\n                .build();\n    \n                console.log(\"SignalR Connected.\");\n    \n                connection.on(\"AddChannel\", (channel) => console.log(channel));\n    \n                connection.on(\"onError\", (msg) => console.log(msg));\n\n                connection.on(\"RecieveMessage\", (message) => {\n                    console.log(\"RECIEVING MESSAGE: \", message, \"\\nCURRENT USER:\", currentUser);\n                    const copyChannel = Object.assign({}, currentUser.roomExistUsers.filter(room => room.id === message.toRoomId)[0]);\n                    if (copyChannel.messages !== null){\n                        copyChannel.messages.push(message);\n                    } else {\n                        copyChannel.messages = [message];\n                    }\n\n                    setChannels(channels => {\n                        channels.map(channel => {\n                            if (channel.id !== copyChannel.id){\n                                return channel;\n                            } else {\n                                return copyChannel;\n                            }\n                        })\n                    });\n                });\n\n                connection.onclose(e => {\n                    setConnection();\n                });\n                \n                await connection.start();\n                setConnection(connection);\n            } catch (err) {\n                console.log(err);\n            };\n        };\n      \n        // call the function\n        connect()\n          // make sure to catch any error\n          .catch(console.error);\n      }, [])\n\n    const createChannel = async (channel, user, members) => {\n        try {\n            await connection.invoke(\"CreateRoom\", channel, user, members);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    const sendMessage = async (channel, user, message) => {\n        try {\n          await connection.invoke(\"SendToRoom\", channel, user, message);\n        } catch (err) {\n          console.log(err);\n        }\n    }    \n\n    const getAllUsers = async () => {\n        try {\n            const data = await connection.invoke(\"GetAllUsers\");\n            return data;\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    return(\n        <div className=\"page\">\n            <Sidebar/>\n            <ChatLobby \n            currentUser={currentUser}\n            channels={channels}\n            setChannels={setChannels}\n            // users={users}\n            // setUsers={setUsers}\n            selectedChannel={selectedChannel}\n            setSelectedChannel={setSelectedChannel}\n            createChannel={createChannel} \n            sendMessage={sendMessage}\n            getAllUsers={getAllUsers}/>\n        </div>\n    );\n};"],"mappings":";;;AAAA,SAAQA,KAAR,EAAeC,QAAf,QAA8B,OAA9B;AAGA,SAASC,WAAT,EAAsBC,QAAtB,EAAgCC,cAAhC,QAAsD,yBAAtD;AAEA,OAAOC,OAAP,MAAoB,oBAApB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;;AAEA,eAAe,SAASC,QAAT,OACI;EAAA;;EAAA,IAAf;IAACC;EAAD,CAAe;EAEfC,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmCF,WAAW,CAACG,cAA/C;EACA,MAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BZ,QAAQ,CAACO,WAAW,CAACG,cAAb,CAAxC,CAHe,CAIf;;EACA,MAAM,CAACG,eAAD,EAAkBC,kBAAlB,IAAwCd,QAAQ,CAAC,EAAD,CAAtD;EAEA,MAAM,CAACe,UAAD,EAAaC,aAAb,IAA8BhB,QAAQ,EAA5C;EAEAQ,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BF,WAA9B;EAEAU,SAAS,CAAC,MAAM;IACZ;IACA,MAAMC,OAAO,GAAG,YAAY;MACxB,IAAI;QACA,MAAMH,UAAU,GAAG,IAAII,oBAAJ,GAClBC,OADkB,CACT,GAAEC,GAAI,UADG,EAElBC,gBAFkB,CAEDC,QAAQ,CAACC,WAFR,EAGlBC,KAHkB,EAAnB;QAKAjB,OAAO,CAACC,GAAR,CAAY,oBAAZ;QAEAM,UAAU,CAACW,EAAX,CAAc,YAAd,EAA6BC,OAAD,IAAanB,OAAO,CAACC,GAAR,CAAYkB,OAAZ,CAAzC;QAEAZ,UAAU,CAACW,EAAX,CAAc,SAAd,EAA0BE,GAAD,IAASpB,OAAO,CAACC,GAAR,CAAYmB,GAAZ,CAAlC;QAEAb,UAAU,CAACW,EAAX,CAAc,gBAAd,EAAiCG,OAAD,IAAa;UACzCrB,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmCoB,OAAnC,EAA4C,iBAA5C,EAA+DtB,WAA/D;UACA,MAAMuB,WAAW,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBzB,WAAW,CAACG,cAAZ,CAA2BuB,MAA3B,CAAkCC,IAAI,IAAIA,IAAI,CAACC,EAAL,KAAYN,OAAO,CAACO,QAA9D,EAAwE,CAAxE,CAAlB,CAApB;;UACA,IAAIN,WAAW,CAACO,QAAZ,KAAyB,IAA7B,EAAkC;YAC9BP,WAAW,CAACO,QAAZ,CAAqBC,IAArB,CAA0BT,OAA1B;UACH,CAFD,MAEO;YACHC,WAAW,CAACO,QAAZ,GAAuB,CAACR,OAAD,CAAvB;UACH;;UAEDjB,WAAW,CAACD,QAAQ,IAAI;YACpBA,QAAQ,CAAC4B,GAAT,CAAaZ,OAAO,IAAI;cACpB,IAAIA,OAAO,CAACQ,EAAR,KAAeL,WAAW,CAACK,EAA/B,EAAkC;gBAC9B,OAAOR,OAAP;cACH,CAFD,MAEO;gBACH,OAAOG,WAAP;cACH;YACJ,CAND;UAOH,CARU,CAAX;QASH,CAlBD;QAoBAf,UAAU,CAACyB,OAAX,CAAmBC,CAAC,IAAI;UACpBzB,aAAa;QAChB,CAFD;QAIA,MAAMD,UAAU,CAAC2B,KAAX,EAAN;QACA1B,aAAa,CAACD,UAAD,CAAb;MACH,CAtCD,CAsCE,OAAO4B,GAAP,EAAY;QACVnC,OAAO,CAACC,GAAR,CAAYkC,GAAZ;MACH;;MAAA;IACJ,CA1CD,CAFY,CA8CZ;;;IACAzB,OAAO,GACL;IADK,CAEJ0B,KAFH,CAESpC,OAAO,CAACqC,KAFjB;EAGD,CAlDM,EAkDJ,EAlDI,CAAT;;EAoDA,MAAMC,aAAa,GAAG,OAAOnB,OAAP,EAAgBoB,IAAhB,EAAsBC,OAAtB,KAAkC;IACpD,IAAI;MACA,MAAMjC,UAAU,CAACkC,MAAX,CAAkB,YAAlB,EAAgCtB,OAAhC,EAAyCoB,IAAzC,EAA+CC,OAA/C,CAAN;IACH,CAFD,CAEE,OAAOL,GAAP,EAAY;MACVnC,OAAO,CAACC,GAAR,CAAYkC,GAAZ;IACH;EACJ,CAND;;EAQA,MAAMO,WAAW,GAAG,OAAOvB,OAAP,EAAgBoB,IAAhB,EAAsBlB,OAAtB,KAAkC;IAClD,IAAI;MACF,MAAMd,UAAU,CAACkC,MAAX,CAAkB,YAAlB,EAAgCtB,OAAhC,EAAyCoB,IAAzC,EAA+ClB,OAA/C,CAAN;IACD,CAFD,CAEE,OAAOc,GAAP,EAAY;MACZnC,OAAO,CAACC,GAAR,CAAYkC,GAAZ;IACD;EACJ,CAND;;EAQA,MAAMQ,WAAW,GAAG,YAAY;IAC5B,IAAI;MACA,MAAMC,IAAI,GAAG,MAAMrC,UAAU,CAACkC,MAAX,CAAkB,aAAlB,CAAnB;MACA,OAAOG,IAAP;IACH,CAHD,CAGE,OAAOT,GAAP,EAAY;MACVnC,OAAO,CAACC,GAAR,CAAYkC,GAAZ;IACH;EACJ,CAPD;;EASA,oBACI;IAAK,SAAS,EAAC,MAAf;IAAA,wBACI,QAAC,OAAD;MAAA;MAAA;MAAA;IAAA,QADJ,eAEI,QAAC,SAAD;MACA,WAAW,EAAEpC,WADb;MAEA,QAAQ,EAAEI,QAFV;MAGA,WAAW,EAAEC,WAHb,CAIA;MACA;MALA;MAMA,eAAe,EAAEC,eANjB;MAOA,kBAAkB,EAAEC,kBAPpB;MAQA,aAAa,EAAEgC,aARf;MASA,WAAW,EAAEI,WATb;MAUA,WAAW,EAAEC;IAVb;MAAA;MAAA;MAAA;IAAA,QAFJ;EAAA;IAAA;IAAA;IAAA;EAAA,QADJ;AAgBH;;GAzGuB7C,Q;;KAAAA,Q;AAyGvB"},"metadata":{},"sourceType":"module"}