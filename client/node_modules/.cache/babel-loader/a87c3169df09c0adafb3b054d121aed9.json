{"ast":null,"code":"var _jsxFileName = \"/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx\",\n    _s = $RefreshSig$();\n\nimport { React, useState, useEffect } from \"react\";\nimport { HubConnectionBuilder, LogLevel } from '@microsoft/signalr';\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst URL = \"https://7def-185-129-94-115.eu.ngrok.io\";\nexport default function ChatPage(_ref) {\n  _s();\n\n  let {\n    currentUser\n  } = _ref;\n  // console.log(\"CURRENT USER ROOMS:\", currentUser.roomExistUsers);\n  const [channels, setChannels] = useState(currentUser.roomExistUsers);\n  const [selectedChannel, setSelectedChannel] = useState({});\n  const [connection, setConnection] = useState();\n  console.log(\"Current user channels: \", channels);\n  useEffect(() => {\n    // declare the data fetching function\n    const connect = async () => {\n      try {\n        const connection = new HubConnectionBuilder().withUrl(`${URL}/chatHub`).configureLogging(LogLevel.Information).build();\n        console.log(\"SignalR Connected.\");\n        connection.on(\"AddChannel\", channel => console.log(channel));\n        connection.on(\"onError\", msg => console.log(msg));\n        connection.on(\"RecieveMessage\", message => {\n          console.log(\"RECIEVING MESSAGE: \", message, \"\\nCURRENT USER:\", currentUser);\n          const copyChannel = { ...channels.filter(room => room.id === message.toRoomId)[0]\n          };\n\n          if (copyChannel.messages !== null) {\n            copyChannel.messages.push(message);\n          } else {\n            copyChannel.messages = [message];\n          }\n\n          const newChannels = channels.map(channel => {\n            if (channel.id !== copyChannel.id) {\n              return channel;\n            } else {\n              return copyChannel;\n            }\n          });\n          setChannels(channels => {\n            newChannels;\n          });\n        });\n        connection.onclose(e => {\n          setConnection();\n        });\n        await connection.start();\n        setConnection(connection);\n      } catch (err) {\n        console.log(err);\n      }\n\n      ;\n    }; // call the function\n\n\n    connect() // make sure to catch any error\n    .catch(console.error);\n  }, [currentUser]);\n\n  const createChannel = async (channel, user, members) => {\n    try {\n      await connection.invoke(\"CreateRoom\", channel, user, members);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const sendMessage = async (channel, user, message) => {\n    try {\n      await connection.invoke(\"SendToRoom\", channel, user, message);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const getAllUsers = async () => {\n    try {\n      const data = await connection.invoke(\"GetAllUsers\");\n      return data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatLobby, {\n      currentUser: currentUser,\n      channels: channels,\n      setChannels: setChannels // users={users}\n      // setUsers={setUsers}\n      ,\n      selectedChannel: selectedChannel,\n      setSelectedChannel: setSelectedChannel,\n      createChannel: createChannel,\n      sendMessage: sendMessage,\n      getAllUsers: getAllUsers\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ChatPage, \"CesSjSxVGwvNMa15PGjGlSE7pio=\");\n\n_c = ChatPage;\n;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useState","useEffect","HubConnectionBuilder","LogLevel","Sidebar","ChatLobby","URL","ChatPage","currentUser","channels","setChannels","roomExistUsers","selectedChannel","setSelectedChannel","connection","setConnection","console","log","connect","withUrl","configureLogging","Information","build","on","channel","msg","message","copyChannel","filter","room","id","toRoomId","messages","push","newChannels","map","onclose","e","start","err","catch","error","createChannel","user","members","invoke","sendMessage","getAllUsers","data"],"sources":["/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx"],"sourcesContent":["import {React, useState, useEffect} from \"react\";\n\nimport { HubConnectionBuilder, LogLevel } from '@microsoft/signalr';\n\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\n\nconst URL = \"https://7def-185-129-94-115.eu.ngrok.io\";\n\nexport default function ChatPage( \n    {currentUser} ){\n\n    // console.log(\"CURRENT USER ROOMS:\", currentUser.roomExistUsers);\n    const [channels, setChannels] = useState(currentUser.roomExistUsers);\n    const [selectedChannel, setSelectedChannel] = useState({});   \n    const [connection, setConnection] = useState();\n    \n    console.log(\"Current user channels: \", channels);\n\n    useEffect(() => {\n        // declare the data fetching function\n        const connect = async () => {\n            try {\n                const connection = new HubConnectionBuilder()\n                .withUrl(`${URL}/chatHub`)\n                .configureLogging(LogLevel.Information)\n                .build();\n    \n                console.log(\"SignalR Connected.\");\n    \n                connection.on(\"AddChannel\", (channel) => console.log(channel));\n    \n                connection.on(\"onError\", (msg) => console.log(msg));\n\n                connection.on(\"RecieveMessage\", (message) => {\n                    console.log(\"RECIEVING MESSAGE: \", message, \"\\nCURRENT USER:\", currentUser);\n                    const copyChannel = {...channels.filter(room => room.id === message.toRoomId)[0]}\n                    if (copyChannel.messages !== null){\n                        copyChannel.messages.push(message);\n                    } else {\n                        copyChannel.messages = [message];\n                    }\n                    \n                    const newChannels = channels.map(channel => {\n                        if (channel.id !== copyChannel.id){\n                            return channel;\n                        } else {\n                            return copyChannel;\n                        }\n                    });\n                    \n\n                    setChannels(channels => {newChannels});\n                });\n\n                connection.onclose(e => {\n                    setConnection();\n                });\n                \n                await connection.start();\n                setConnection(connection);\n            } catch (err) {\n                console.log(err);\n            };\n        };\n      \n        // call the function\n        connect()\n          // make sure to catch any error\n          .catch(console.error);\n      }, [currentUser])\n\n    const createChannel = async (channel, user, members) => {\n        try {\n            await connection.invoke(\"CreateRoom\", channel, user, members);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    const sendMessage = async (channel, user, message) => {\n        try {\n          await connection.invoke(\"SendToRoom\", channel, user, message);\n        } catch (err) {\n          console.log(err);\n        }\n    }    \n\n    const getAllUsers = async () => {\n        try {\n            const data = await connection.invoke(\"GetAllUsers\");\n            return data;\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    return(\n        <div className=\"page\">\n            <Sidebar/>\n            <ChatLobby \n            currentUser={currentUser}\n            channels={channels}\n            setChannels={setChannels}\n            // users={users}\n            // setUsers={setUsers}\n            selectedChannel={selectedChannel}\n            setSelectedChannel={setSelectedChannel}\n            createChannel={createChannel} \n            sendMessage={sendMessage}\n            getAllUsers={getAllUsers}/>\n        </div>\n    );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}