{"ast":null,"code":"var _jsxFileName = \"/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { HubConnectionBuilder, LogLevel } from '@microsoft/signalr';\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst URL = \"https://5d74-185-129-94-115.eu.ngrok.io\";\nexport default function ChatPage(_ref) {\n  _s();\n\n  let {\n    currentUser\n  } = _ref;\n  const [channels, setChannels] = useState(currentUser.roomExistUsers);\n  const [selectedChannel, setSelectedChannel] = useState({});\n  const [connection, setConnection] = useState();\n  console.log(channels);\n  useEffect(() => {\n    console.log(\"Connection!\");\n\n    const connect = async () => {\n      try {\n        const connection = new HubConnectionBuilder().withUrl(`${URL}/chatHub`).configureLogging(LogLevel.Information).withAutomaticReconnect(2000).build();\n        connection.on(\"AddChannel\", channel => console.log(channel));\n        connection.on(\"onError\", msg => console.log(msg));\n        connection.on(\"RecieveMessage\", message => {\n          console.log(\"New message: \", message);\n          console.log(\"After new mssage: \", channels);\n          const copyChannel = { ...channels.filter(room => room.id === message.toRoomId)[0]\n          };\n\n          if (copyChannel.messages !== null) {\n            copyChannel.messages.push(message);\n          } else {\n            copyChannel.messages = [message];\n          }\n\n          const newChannels = channels.map(channel => {\n            if (channel.id !== copyChannel.id) {\n              return channel;\n            } else {\n              return copyChannel;\n            }\n          });\n          setChannels(channels => newChannels);\n        });\n        connection.onclose(e => {\n          setConnection();\n        });\n        await connection.start();\n        setConnection(connection);\n        console.log(\"connection id: \", connection.ConnectionId);\n      } catch (err) {\n        console.log(err);\n      }\n\n      ;\n    };\n\n    connect().catch(console.error);\n  }, []);\n\n  const createChannel = async (channel, user, members) => {\n    try {\n      const room = await connection.invoke(\"CreateRoom\", channel, user, members);\n      console.log(\"New room: \", room);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const sendMessage = async (channel, user, message) => {\n    try {\n      await connection.invoke(\"SendToRoom\", channel, user, message);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const getAllUsers = async () => {\n    try {\n      const data = await connection.invoke(\"GetAllUsers\");\n      return data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const addToGroup = async (channelName, userName) => {\n    try {\n      await connection.invoke(\"Join\", channelName, userName);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const removeUser = async (channel, userId) => {\n    try {\n      await connection.invoke(\"Remove\", channel, userId);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatLobby, {\n      currentUser: currentUser,\n      channels: channels,\n      setChannels: setChannels // users={users}\n      // setUsers={setUsers}\n      ,\n      selectedChannel: selectedChannel,\n      setSelectedChannel: setSelectedChannel,\n      createChannel: createChannel,\n      sendMessage: sendMessage,\n      getAllUsers: getAllUsers,\n      addToGroup: addToGroup,\n      removeUser: removeUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ChatPage, \"CesSjSxVGwvNMa15PGjGlSE7pio=\");\n\n_c = ChatPage;\n;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useState","useEffect","HubConnectionBuilder","LogLevel","Sidebar","ChatLobby","URL","ChatPage","currentUser","channels","setChannels","roomExistUsers","selectedChannel","setSelectedChannel","connection","setConnection","console","log","connect","withUrl","configureLogging","Information","withAutomaticReconnect","build","on","channel","msg","message","copyChannel","filter","room","id","toRoomId","messages","push","newChannels","map","onclose","e","start","ConnectionId","err","catch","error","createChannel","user","members","invoke","sendMessage","getAllUsers","data","addToGroup","channelName","userName","removeUser","userId"],"sources":["/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx"],"sourcesContent":["import React, { useState, useEffect} from \"react\";\n\nimport { HubConnectionBuilder, LogLevel } from '@microsoft/signalr';\n\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\n\nconst URL = \"https://5d74-185-129-94-115.eu.ngrok.io\";\n\nexport default function ChatPage({ currentUser }){\n\n    const [channels, setChannels] = useState(currentUser.roomExistUsers);\n    const [selectedChannel, setSelectedChannel] = useState({});   \n    const [connection, setConnection] = useState();\n\n    console.log(channels);\n\n    useEffect(() => {\n        console.log(\"Connection!\")\n        const connect = async () => {\n            try {\n                const connection = new HubConnectionBuilder()\n                .withUrl(`${URL}/chatHub`)\n                .configureLogging(LogLevel.Information)\n                .withAutomaticReconnect(2000)\n                .build();\n    \n                connection.on(\"AddChannel\", (channel) => console.log(channel));\n\n                connection.on(\"onError\", (msg) => console.log(msg));\n\n                connection.on(\"RecieveMessage\", (message) => {\n                    console.log(\"New message: \", message);\n                    console.log(\"After new mssage: \", channels);\n                    const copyChannel = {...channels.filter(room => room.id === message.toRoomId)[0]}\n                    if (copyChannel.messages !== null){\n                        copyChannel.messages.push(message);\n                    } else {\n                        copyChannel.messages = [message];\n                    }\n                    \n                    const newChannels = channels.map(channel => {\n                        if (channel.id !== copyChannel.id){\n                            return channel;\n                        } else {\n                            return copyChannel;\n                        }\n                    });\n                    setChannels(channels => newChannels);\n                });\n\n                connection.onclose(e => {\n                    setConnection();\n                });\n                \n                await connection.start();\n                setConnection(connection);\n                console.log(\"connection id: \", connection.ConnectionId);\n            } catch (err) {\n                console.log(err);\n            };\n        };\n      \n        connect().catch(console.error);\n      }, [])\n\n    const createChannel = async (channel, user, members) => {\n        try {\n            const room = await connection.invoke(\"CreateRoom\", channel, user, members);\n            console.log(\"New room: \", room);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    const sendMessage = async (channel, user, message) => {\n        try {\n          await connection.invoke(\"SendToRoom\", channel, user, message);\n        } catch (err) {\n          console.log(err);\n        }\n    }    \n\n    const getAllUsers = async () => {\n        try {\n            const data = await connection.invoke(\"GetAllUsers\");\n            return data;\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    const addToGroup = async (channelName, userName) => {\n        try {\n            await connection.invoke(\"Join\", channelName, userName);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    const removeUser = async (channel, userId) => {\n        try {\n            await connection.invoke(\"Remove\", channel, userId);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    return(\n        <div className=\"page\">\n            <Sidebar/>\n            <ChatLobby \n            currentUser={currentUser}\n            channels={channels}\n            setChannels={setChannels}\n            // users={users}\n            // setUsers={setUsers}\n            selectedChannel={selectedChannel}\n            setSelectedChannel={setSelectedChannel}\n            createChannel={createChannel} \n            sendMessage={sendMessage}\n            getAllUsers={getAllUsers}\n            addToGroup={addToGroup}\n            removeUser={removeUser}/>\n        </div>\n    );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}