{"ast":null,"code":"var _jsxFileName = \"/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport connect from \"../../api/Connector\";\nimport ConnectionController from \"../../api/ConnectionController\";\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function ChatPage(_ref) {\n  _s();\n\n  let {\n    currentUser\n  } = _ref;\n  const [channels, setChannels] = useState(currentUser.roomExistUsers);\n  const [selectedChannel, setSelectedChannel] = useState({});\n  const [connectionController, setConnectionController] = useState();\n  useEffect(() => {\n    connectionController.subscribeEvent(createChannelEvent);\n\n    createChannelEvent.on = channel => {\n      setChannels(channels => [...channels, channel]);\n    };\n\n    getAllUsers().then(data => {\n      setUsers(data);\n    }).catch(err => console.log(err));\n    const getConnection = connect();\n    getConnection.then(connection => {\n      const connectionController = new ConnectionController(connection);\n      setConnectionController(connectionController);\n    }).catch(() => alert('connection failed'));\n  }, []); // useEffect(() => {\n  //     console.log(\"Connection!\")\n  //     const connect = async () => {\n  //         try {\n  //             const connection = new HubConnectionBuilder()\n  //             .withUrl(`${URL}/chatHub`)\n  //             .configureLogging(LogLevel.Information)\n  //             .withAutomaticReconnect(2000)\n  //             .build();\n  //             connection.on(\"AddChannel\", (channel) => console.log(channel));\n  //             connection.on(\"onError\", (msg) => console.log(msg));\n  //             connection.on(\"RecieveMessage\", (message) => {\n  //                 console.log(\"New message: \", message);\n  //                 console.log(\"After new mssage: \", channels);\n  //                 const copyChannel = {...channels.filter(room => room.id === message.toRoomId)[0]}\n  //                 if (copyChannel.messages !== null){\n  //                     copyChannel.messages.push(message);\n  //                 } else {\n  //                     copyChannel.messages = [message];\n  //                 }\n  //                 const newChannels = channels.map(channel => {\n  //                     if (channel.id !== copyChannel.id){\n  //                         return channel;\n  //                     } else {\n  //                         return copyChannel;\n  //                     }\n  //                 });\n  //                 setChannels(channels => newChannels);\n  //             });\n  //             connection.onclose(e => {\n  //                 setConnection();\n  //             });\n  //             await connection.start();\n  //             setConnection(connection);\n  //             console.log(\"connection id: \", connection.ConnectionId);\n  //         } catch (err) {\n  //             console.log(err);\n  //         };\n  //     };\n  //     connect().catch(console.error);\n  //   }, [])\n  // const createChannel = async (channel, user, members) => {\n  //     try {\n  //         const room = await connection.invoke(\"CreateRoom\", channel, user, members);\n  //         console.log(\"New room: \", room);\n  //     } catch (err) {\n  //         console.log(err);\n  //     }\n  // }\n  // const sendMessage = async (channel, user, message) => {\n  //     try {\n  //       await connection.invoke(\"SendToRoom\", channel, user, message);\n  //     } catch (err) {\n  //       console.log(err);\n  //     }\n  // }    \n  // const getAllUsers = async () => {\n  //     try {\n  //         const data = await connection.invoke(\"GetAllUsers\");\n  //         return data;\n  //     } catch (err) {\n  //         console.log(err);\n  //     }\n  // }\n  // const addToGroup = async (channelName, userName) => {\n  //     try {\n  //         await connection.invoke(\"Join\", channelName, userName);\n  //     } catch (err) {\n  //         console.log(err);\n  //     }\n  // }\n  // const removeUser = async (channelName, userId, channelId) => {\n  //     try {\n  //         await connection.invoke(\"Remove\", channelName, userId, channelId);\n  //     } catch (err) {\n  //         console.log(err);\n  //     }\n  // }\n\n  /*      // sendMessage={sendMessage}\n          // getAllUsers={getAllUsers}\n          // addToGroup={addToGroup}\n          // removeUser={removeUser}/>*/\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatLobby, {\n      currentUser: currentUser,\n      channels: channels,\n      setChannels: setChannels // users={users}\n      // setUsers={setUsers}\n      ,\n      selectedChannel: selectedChannel,\n      setSelectedChannel: setSelectedChannel,\n      connectionController: connectionController\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n}\n\n_s(ChatPage, \"6u05jI61lSD1KJFphOTpvQCxmLE=\");\n\n_c = ChatPage;\n;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useState","useEffect","connect","ConnectionController","Sidebar","ChatLobby","ChatPage","currentUser","channels","setChannels","roomExistUsers","selectedChannel","setSelectedChannel","connectionController","setConnectionController","subscribeEvent","createChannelEvent","on","channel","getAllUsers","then","data","setUsers","catch","err","console","log","getConnection","connection","alert"],"sources":["/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx"],"sourcesContent":["import React, { useState, useEffect} from \"react\";\n\nimport connect from \"../../api/Connector\";\nimport ConnectionController from \"../../api/ConnectionController\";\n\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\n\n\nexport default function ChatPage({ currentUser }){\n\n    const [channels, setChannels] = useState(currentUser.roomExistUsers);\n    const [selectedChannel, setSelectedChannel] = useState({});   \n    const [connectionController, setConnectionController] = useState();\n\n    useEffect(() => {\n        connectionController.subscribeEvent(createChannelEvent);\n\n        createChannelEvent.on = (channel) => {\n            setChannels(channels => [...channels, channel]);\n        }\n\n        getAllUsers().then(data => {\n            setUsers(data);\n        }).catch(err => console.log(err));\n        \n        const getConnection = connect();\n\n        getConnection.then((connection) => {\n            const connectionController = new ConnectionController(connection);\n\n            setConnectionController(connectionController);\n        }).catch(() => alert('connection failed'));\n\n    }, [])\n\n\n\n    // useEffect(() => {\n    //     console.log(\"Connection!\")\n    //     const connect = async () => {\n    //         try {\n    //             const connection = new HubConnectionBuilder()\n    //             .withUrl(`${URL}/chatHub`)\n    //             .configureLogging(LogLevel.Information)\n    //             .withAutomaticReconnect(2000)\n    //             .build();\n    \n    //             connection.on(\"AddChannel\", (channel) => console.log(channel));\n\n    //             connection.on(\"onError\", (msg) => console.log(msg));\n\n    //             connection.on(\"RecieveMessage\", (message) => {\n    //                 console.log(\"New message: \", message);\n    //                 console.log(\"After new mssage: \", channels);\n    //                 const copyChannel = {...channels.filter(room => room.id === message.toRoomId)[0]}\n    //                 if (copyChannel.messages !== null){\n    //                     copyChannel.messages.push(message);\n    //                 } else {\n    //                     copyChannel.messages = [message];\n    //                 }\n                    \n    //                 const newChannels = channels.map(channel => {\n    //                     if (channel.id !== copyChannel.id){\n    //                         return channel;\n    //                     } else {\n    //                         return copyChannel;\n    //                     }\n    //                 });\n    //                 setChannels(channels => newChannels);\n    //             });\n\n    //             connection.onclose(e => {\n    //                 setConnection();\n    //             });\n                \n    //             await connection.start();\n    //             setConnection(connection);\n    //             console.log(\"connection id: \", connection.ConnectionId);\n    //         } catch (err) {\n    //             console.log(err);\n    //         };\n    //     };\n      \n    //     connect().catch(console.error);\n    //   }, [])\n\n    // const createChannel = async (channel, user, members) => {\n    //     try {\n    //         const room = await connection.invoke(\"CreateRoom\", channel, user, members);\n    //         console.log(\"New room: \", room);\n    //     } catch (err) {\n    //         console.log(err);\n    //     }\n    // }\n\n    // const sendMessage = async (channel, user, message) => {\n    //     try {\n    //       await connection.invoke(\"SendToRoom\", channel, user, message);\n    //     } catch (err) {\n    //       console.log(err);\n    //     }\n    // }    \n\n    // const getAllUsers = async () => {\n    //     try {\n    //         const data = await connection.invoke(\"GetAllUsers\");\n    //         return data;\n    //     } catch (err) {\n    //         console.log(err);\n    //     }\n    // }\n\n    // const addToGroup = async (channelName, userName) => {\n    //     try {\n    //         await connection.invoke(\"Join\", channelName, userName);\n    //     } catch (err) {\n    //         console.log(err);\n    //     }\n    // }\n\n    // const removeUser = async (channelName, userId, channelId) => {\n    //     try {\n    //         await connection.invoke(\"Remove\", channelName, userId, channelId);\n    //     } catch (err) {\n    //         console.log(err);\n    //     }\n    // }\n\n    /*      // sendMessage={sendMessage}\n            // getAllUsers={getAllUsers}\n            // addToGroup={addToGroup}\n            // removeUser={removeUser}/>*/\n\n    return(\n        <>\n            <Sidebar/>\n            <ChatLobby \n                currentUser={currentUser}\n                channels={channels}\n                setChannels={setChannels}\n                // users={users}\n                // setUsers={setUsers}\n                selectedChannel={selectedChannel}\n                setSelectedChannel={setSelectedChannel}\n                connectionController={connectionController}/>\n        </>\n    );\n};"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA0C,OAA1C;AAEA,OAAOC,OAAP,MAAoB,qBAApB;AACA,OAAOC,oBAAP,MAAiC,gCAAjC;AAEA,OAAOC,OAAP,MAAoB,oBAApB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;;;AAGA,eAAe,SAASC,QAAT,OAAkC;EAAA;;EAAA,IAAhB;IAAEC;EAAF,CAAgB;EAE7C,MAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BT,QAAQ,CAACO,WAAW,CAACG,cAAb,CAAxC;EACA,MAAM,CAACC,eAAD,EAAkBC,kBAAlB,IAAwCZ,QAAQ,CAAC,EAAD,CAAtD;EACA,MAAM,CAACa,oBAAD,EAAuBC,uBAAvB,IAAkDd,QAAQ,EAAhE;EAEAC,SAAS,CAAC,MAAM;IACZY,oBAAoB,CAACE,cAArB,CAAoCC,kBAApC;;IAEAA,kBAAkB,CAACC,EAAnB,GAAyBC,OAAD,IAAa;MACjCT,WAAW,CAACD,QAAQ,IAAI,CAAC,GAAGA,QAAJ,EAAcU,OAAd,CAAb,CAAX;IACH,CAFD;;IAIAC,WAAW,GAAGC,IAAd,CAAmBC,IAAI,IAAI;MACvBC,QAAQ,CAACD,IAAD,CAAR;IACH,CAFD,EAEGE,KAFH,CAESC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAFhB;IAIA,MAAMG,aAAa,GAAGzB,OAAO,EAA7B;IAEAyB,aAAa,CAACP,IAAd,CAAoBQ,UAAD,IAAgB;MAC/B,MAAMf,oBAAoB,GAAG,IAAIV,oBAAJ,CAAyByB,UAAzB,CAA7B;MAEAd,uBAAuB,CAACD,oBAAD,CAAvB;IACH,CAJD,EAIGU,KAJH,CAIS,MAAMM,KAAK,CAAC,mBAAD,CAJpB;EAMH,CAnBQ,EAmBN,EAnBM,CAAT,CAN6C,CA6B7C;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EAEA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;AACJ;AACA;AACA;;EAEI,oBACI;IAAA,wBACI,QAAC,OAAD;MAAA;MAAA;MAAA;IAAA,QADJ,eAEI,QAAC,SAAD;MACI,WAAW,EAAEtB,WADjB;MAEI,QAAQ,EAAEC,QAFd;MAGI,WAAW,EAAEC,WAHjB,CAII;MACA;MALJ;MAMI,eAAe,EAAEE,eANrB;MAOI,kBAAkB,EAAEC,kBAPxB;MAQI,oBAAoB,EAAEC;IAR1B;MAAA;MAAA;MAAA;IAAA,QAFJ;EAAA,gBADJ;AAcH;;GA3IuBP,Q;;KAAAA,Q;AA2IvB"},"metadata":{},"sourceType":"module"}