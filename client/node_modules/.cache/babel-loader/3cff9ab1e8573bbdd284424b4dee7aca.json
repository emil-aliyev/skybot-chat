{"ast":null,"code":"var _jsxFileName = \"/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx\",\n    _s = $RefreshSig$();\n\nimport { React, useState, useEffect } from \"react\";\nimport { HubConnectionBuilder, LogLevel } from '@microsoft/signalr';\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst URL = \"https://7def-185-129-94-115.eu.ngrok.io\";\nexport default function ChatPage(_ref) {\n  _s();\n\n  let {\n    currentUser\n  } = _ref;\n  // console.log(\"CURRENT USER ROOMS:\", currentUser.roomExistUsers);\n  const [channels, setChannels] = useState(currentUser.roomExistUsers);\n  const [selectedChannel, setSelectedChannel] = useState({});\n  const [connection, setConnection] = useState();\n  console.log(\"Current user channels: \", channels);\n  useEffect(() => {\n    // declare the data fetching function\n    const connect = async () => {\n      try {\n        const connection = new HubConnectionBuilder().withUrl(`${URL}/chatHub`).configureLogging(LogLevel.Information).build();\n        console.log(\"SignalR Connected.\");\n        connection.on(\"AddChannel\", channel => console.log(channel));\n        connection.on(\"onError\", msg => console.log(msg));\n        connection.on(\"RecieveMessage\", message => {\n          console.log(\"RECIEVING MESSAGE: \", message, \"\\nCURRENT USER:\", currentUser);\n          const copyChannel = Object.assign({}, currentUser.roomExistUsers.filter(room => room.id === message.toRoomId)[0]);\n\n          if (copyChannel.messages !== null) {\n            copyChannel.messages.push(message);\n          } else {\n            copyChannel.messages = [message];\n          }\n\n          setChannels(channels => {\n            channels.map(channel => {\n              if (channel.id !== copyChannel.id) {\n                return channel;\n              } else {\n                return copyChannel;\n              }\n            });\n          });\n        });\n        connection.onclose(e => {\n          setConnection();\n        });\n        await connection.start();\n        setConnection(connection);\n      } catch (err) {\n        console.log(err);\n      }\n\n      ;\n    }; // call the function\n\n\n    connect() // make sure to catch any error\n    .catch(console.error);\n  }, [currentUser.roomExistUsers]);\n\n  const createChannel = async (channel, user, members) => {\n    try {\n      await connection.invoke(\"CreateRoom\", channel, user, members);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const sendMessage = async (channel, user, message) => {\n    try {\n      await connection.invoke(\"SendToRoom\", channel, user, message);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const getAllUsers = async () => {\n    try {\n      const data = await connection.invoke(\"GetAllUsers\");\n      return data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatLobby, {\n      currentUser: currentUser,\n      channels: channels,\n      setChannels: setChannels // users={users}\n      // setUsers={setUsers}\n      ,\n      selectedChannel: selectedChannel,\n      setSelectedChannel: setSelectedChannel,\n      createChannel: createChannel,\n      sendMessage: sendMessage,\n      getAllUsers: getAllUsers\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ChatPage, \"CesSjSxVGwvNMa15PGjGlSE7pio=\");\n\n_c = ChatPage;\n;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useState","useEffect","HubConnectionBuilder","LogLevel","Sidebar","ChatLobby","URL","ChatPage","currentUser","channels","setChannels","roomExistUsers","selectedChannel","setSelectedChannel","connection","setConnection","console","log","connect","withUrl","configureLogging","Information","build","on","channel","msg","message","copyChannel","Object","assign","filter","room","id","toRoomId","messages","push","map","onclose","e","start","err","catch","error","createChannel","user","members","invoke","sendMessage","getAllUsers","data"],"sources":["/home/emil/Desktop/skybot-chat/skybot-chat/client/src/components/page/ChatPage.jsx"],"sourcesContent":["import {React, useState, useEffect} from \"react\";\n\nimport { HubConnectionBuilder, LogLevel } from '@microsoft/signalr';\n\nimport Sidebar from \"../sidebar/Sidebar\";\nimport ChatLobby from '../lobby/ChatLobby';\n\nconst URL = \"https://7def-185-129-94-115.eu.ngrok.io\";\n\nexport default function ChatPage( \n    {currentUser} ){\n\n    // console.log(\"CURRENT USER ROOMS:\", currentUser.roomExistUsers);\n    const [channels, setChannels] = useState(currentUser.roomExistUsers);\n    const [selectedChannel, setSelectedChannel] = useState({});   \n    const [connection, setConnection] = useState();\n    \n    console.log(\"Current user channels: \", channels);\n\n    useEffect(() => {\n        // declare the data fetching function\n        const connect = async () => {\n            try {\n                const connection = new HubConnectionBuilder()\n                .withUrl(`${URL}/chatHub`)\n                .configureLogging(LogLevel.Information)\n                .build();\n    \n                console.log(\"SignalR Connected.\");\n    \n                connection.on(\"AddChannel\", (channel) => console.log(channel));\n    \n                connection.on(\"onError\", (msg) => console.log(msg));\n\n                connection.on(\"RecieveMessage\", (message) => {\n                    console.log(\"RECIEVING MESSAGE: \", message, \"\\nCURRENT USER:\", currentUser);\n                    const copyChannel = Object.assign({}, currentUser.roomExistUsers.filter(room => room.id === message.toRoomId)[0]);\n                    if (copyChannel.messages !== null){\n                        copyChannel.messages.push(message);\n                    } else {\n                        copyChannel.messages = [message];\n                    }\n\n                    setChannels(channels => {\n                        channels.map(channel => {\n                            if (channel.id !== copyChannel.id){\n                                return channel;\n                            } else {\n                                return copyChannel;\n                            }\n                        })\n                    });\n                });\n\n                connection.onclose(e => {\n                    setConnection();\n                });\n                \n                await connection.start();\n                setConnection(connection);\n            } catch (err) {\n                console.log(err);\n            };\n        };\n      \n        // call the function\n        connect()\n          // make sure to catch any error\n          .catch(console.error);\n      }, [currentUser.roomExistUsers])\n\n    const createChannel = async (channel, user, members) => {\n        try {\n            await connection.invoke(\"CreateRoom\", channel, user, members);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    const sendMessage = async (channel, user, message) => {\n        try {\n          await connection.invoke(\"SendToRoom\", channel, user, message);\n        } catch (err) {\n          console.log(err);\n        }\n    }    \n\n    const getAllUsers = async () => {\n        try {\n            const data = await connection.invoke(\"GetAllUsers\");\n            return data;\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    return(\n        <div className=\"page\">\n            <Sidebar/>\n            <ChatLobby \n            currentUser={currentUser}\n            channels={channels}\n            setChannels={setChannels}\n            // users={users}\n            // setUsers={setUsers}\n            selectedChannel={selectedChannel}\n            setSelectedChannel={setSelectedChannel}\n            createChannel={createChannel} \n            sendMessage={sendMessage}\n            getAllUsers={getAllUsers}/>\n        </div>\n    );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}